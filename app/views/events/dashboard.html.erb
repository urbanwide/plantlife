<%= render :partial => '/shared/flash' , :locals => {:flash => flash} %>

<div class="row">
  <div class="col-md-4">
    <% unless @event.twitter_account.blank? %>
      <h3><span class="glyphicon glyphicon-comment" aria-hidden="true"></span> @otleyscience</h3>

      <a class="twitter-timeline" data-dnt="true" href="https://twitter.com/<%=h @event.twitter_account %>" data-widget-id="529013524039622656">Tweets by <%=h @event.twitter_account %></a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    <% end %>
  </div>
  <div class="col-md-8">
    <div>
      <h3><span class="glyphicon glyphicon-phone" aria-hidden="true"></span> Sunflowers Raised </h3>
      <div style="text-align:right;">
        <div class="progress">
          <div class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%">
            10cm - Ian Kirk
          </div>
        </div>
        <div class="progress">
          <div class="progress-bar progress-bar-warning progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 90%">
            9cm - Deb Bassett
          </div>
        </div>
        <div class="progress">
          <div class="progress-bar progress-bar-info progress-bar-striped active" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
            8cm - Josie Smith
          </div>
        </div>
      </div>

    </div>
    <div>
        <% unless @event.flickr_group_id.blank? %>
      <h3><span class="glyphicon glyphicon-camera" aria-hidden="true"></span> Latest from Flickr</h3>

        <div id="flickr"></div>
        <% end %>
    </div>
  </div>
</div>


<script type="text/javascript">
        //<![CDATA[
        var plantcounter;
		function updateCounter(token)
		{
		      $.ajax({      method: 'get',
		                    url : '/events/'+token+'/plants/counter',
		                    dataType : 'text',
		                    success: function (text) { plantcounter.setValue(parseInt(text)); }
		                 });
		
		}    
        $(function(){
            // Initialize a new counter
            plantcounter = new flipCounter('flip-counter', {value: <%= @count %>, digits: 4, auto: false});
        });  
        setInterval("updateCounter('<%=h @event.token %>')", 5000);
//]]>
</script>

<% unless @event.flickr_group_id.blank? %>
<script type="text/javascript">
$.getJSON("http://api.flickr.com/services/feeds/groups_pool.gne?jsoncallback=?",{id:"<%=h @event.flickr_group_id %>", format: "json" },
  function(data) {
    $.each(data.items, function(i,item){
        console.log(item)
        console.log(item.media)
            $("<img/>").attr({src : item.media.m.replace('_m.','_z.')}).appendTo("#flickr");
        if ( i == 3 ) {
            $('#flickr').coinslider({ hoverPause: false, navigation: true, width: 640, height: 400, delay: 5000 });
            return false;
        }
    });
  });
</script>
<% end %>
